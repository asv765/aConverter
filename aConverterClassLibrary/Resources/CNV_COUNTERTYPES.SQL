/******************************************************************************/
/***               Generated by IBExpert 30.06.2015 23:21:29                ***/
/******************************************************************************/

/******************************************************************************/
/***      Following SET SQL DIALECT is just for the Database Comparer       ***/
/******************************************************************************/
/* SET SQL DIALECT 3; */



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/


CREATE GENERATOR GEN_CNV$COUNTERTYPES_ID;

CREATE TABLE CNV$COUNTERTYPES (
    ID          		INTEGER NOT NULL,
    EQUIPMENTTYPEID		INTEGER NOT NULL,
    PERIODKOD       	INTEGER,
    NAME     			VARCHAR(50),
    COEFFICIENT   		INTEGER,
    DIGITCOUNT   		INTEGER NOT NULL,
    EQUIPMENTGROUPID	INTEGER NOT NULL,
    EXTORGCD   			INTEGER,
    DIMENSIONTYPE   	VARCHAR(50),
    MINCONSUMPTION     	NUMERIC(18,4),
    MAXCONSUMPTION     	NUMERIC(18,4),
    MINTEMPERATURE      NUMERIC(18,4),
    MAXTEMPERATURE   	NUMERIC(18,4),
    COUNTERMARKMODULEID	INTEGER,
	SERVICELIFEID		INTEGER,
    ACCURACY        	NUMERIC(18,6),
	PRIMARY KEY (ID)
);


/******************************************************************************/
/***                                Triggers                                ***/
/******************************************************************************/


SET TERM ^ ;



/******************************************************************************/
/***                          Triggers for tables                           ***/
/******************************************************************************/


/* Trigger: CNV$COUNTERTYPES_BI */
CREATE OR ALTER TRIGGER CNV$COUNTERTYPES_BI FOR CNV$COUNTERTYPES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.ID IS NULL OR NEW.ID = 0) THEN
    NEW.ID = GEN_ID(GEN_CNV$COUNTERTYPES_ID,1);
END
^

CREATE OR ALTER trigger cnv$countertypes_digitscheck for cnv$countertypes
active before insert position 0
AS
begin
  if (new.digitcount < 1) then EXCEPTION CNV$WRONG_PARAMATER_VALUE 'Разрядность не может быть меньше 1';
  if (new.coefficient < 1) then EXCEPTION cnv$wrong_paramater_value 'Коэффециент пересчета показаний не может быть меньше 1';
  if (new.minconsumption is null) then new.minconsumption = 0;
  if (new.maxconsumption is null) then new.maxconsumption = 0;
  if (new.mintemperature is null) then new.mintemperature = 0;
  if (new.maxtemperature is null) then new.maxtemperature = 0;
  if (new.accuracy is null) then new.accuracy = 0;
end
^

SET TERM ; ^



/******************************************************************************/
/***                               Privileges                               ***/
/******************************************************************************/
